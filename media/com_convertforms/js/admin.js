jQuery(function(l){l.fn.awesomeEditor=function(e){var i=this,n=l.extend({plugin:"Convert Forms Editor",debug:!0,form:i.find(".nrEditorOptions #adminForm"),root:i.data("root"),GoogleFonts:ConvertFormsGoogleFonts},e),t=new function(){var e=this;this.container=i.get(0),this.init=function(){a(n.root+"media/com_convertforms/css/convertforms.css"),this.resizeContainer(),jQuery("#toolbar").clone().appendTo(l(".nrEditorTools .r")),l(window).resize(function(){e.resizeContainer()})},this.resizeContainer=function(){heights=["header"];var t=0;heights.each(function(e){t+=l(e).outerHeight()}),height=l(window).height()-t,i.height(height+1)},this.initEditorFields=function(){tinyMCE.remove(),tinyMCE.init({init_instance_callback:function(e){e.on("ExecCommand",function(){tinyMCE.triggerSave(),r()}),e.on("blur",function(){tinyMCE.triggerSave(),r()})},content_css:n.root+"templates/system/css/editor.css",document_base_url:n.root,height:"170",plugins:"textcolor, code, colorpicker, fullscreen, link, image",selector:".editorx",toolbar1:"fontsizeselect styleselect link unlink image mybutton",toolbar2:"forecolor | bold italic underline | alignleft aligncenter alignright | code fullscreen",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px 42px 46px 48px 50px 52px",mode:"specific_textareas",entity_encoding:"raw",forced_root_block:"",toolbar_items_size:"small",statusbar:!1,menubar:!1,inline_styles:!0,force_br_newlines:!1,relative_urls:!1,remove_script_host:!1,paste_data_images:!0,importcss_append:!0,image_advtab:!0,valid_children:"+div[style]"})},this.loadGoogleFont=function(e){-1<n.GoogleFonts.indexOf(e)&&a("//fonts.googleapis.com/css?family="+encodeURIComponent(e))},this.goToPanel=function(e,t){i.find(".nav-tabs li a[href=#"+e+"]").trigger("click"),i.find(".tab-content .accordion-group."+t+" .accordion-heading a.collapsed").trigger("click")},this.getFieldList=function(){var r=[];return this.container.querySelectorAll(".fmItem").forEach(function(e){var t=e.querySelector('input[name*="[name]"]');if(t){var i=t.value,n=i,o=e.querySelector('input[name*="[label]"]');o&&""!=o.value.length&&(n=o.value),r[i]=n}}),r}};t.init();var o=!1;function r(t){o||(formData=n.form.find("select, input[name*=jform], textarea").serialize(),l.ajax({type:"POST",url:n.root+"administrator/index.php?option=com_convertforms&view=form&layout=preview&format=raw",data:formData,success:function(e){d("AJAX Request: Success"),t?l(".nrEditorPreviewContainer").hide().html(e).fadeIn():l(".nrEditorPreviewContainer").html(e),l("#preview-successmsg").trigger("change")},beforeSend:function(){d("AJAX Request: Start"),o=!0,l(".loader").fadeIn()},complete:function(){o=!1,l(".loader").fadeOut()},error:function(e,t,i){s(i)}}))}function a(e){l("link[href='"+e+"']").length?d("Stylesheet "+e+" is already loaded"):(d("Loading stylesheet "+e),l("head").append(l('<link rel="stylesheet" type="text/css" />').attr("href",e)))}function d(e){n.debug&&console.log("["+n.plugin+"] "+e)}function s(e){Joomla.renderMessages({error:[e]})}return i.on("renderForm",function(){r()}),i.on("error",function(e,t){s(t)}),l(document).on("click",".cf-control-group",function(){key=l(this).data("key"),i.trigger("controlGroupClick",[key])}),l(".page-title").click(function(){t.goToPanel("design","box"),l("#jform_name").focus()}),l(document).on("change",".nrEditorOptions input, .nrEditorOptions select, .nrEditorOptions textarea",function(e){$el=l(e.target),$el.hasClass("norender")||(isColorPicker=$el.hasClass("minicolors-input"),isColorPicker?function(){var i=0;return function(e,t){clearTimeout(i),i=setTimeout(e,t)}}()(function(){r()},100):r())}),l(document).on("subform-row-add subform-row-remove nrChoicesUpdate",function(){setTimeout(function(){r()},50)}),l(document).on("subform-row-add",function(){t.initEditorFields()}),l(document).on("submit",".cf form",function(){return!1}),l(window).load(function(){t.initEditorFields(),l("select.nrfont").change(function(){t.loadGoogleFont(l(this).val())}).trigger("change"),r(!0)}),l(".nrEditorTools #toolbar-refresh .btn").removeAttr("onclick"),l(".nrEditorTools #toolbar-refresh").on("click",function(e){return e.preventDefault(),r(),!1}),l("#preview-successmsg").change(function(){box=l(".nrEditorPreview .cf"),l(this).is(":checked")?(successMessage=l("#jform_successmsg").val(),box.find(".cf-response").html(successMessage),box.addClass("cf-success"),l("#jform_hideform0").is(":checked")?box.addClass("cf-success-hideform"):box.removeClass("cf-success-hideform")):box.removeClass("cf-success cf-error")}),window.ConvertFormsBuilder=t,this}}),jQuery(function(e){editor=e(".nrEditor"),editor.length&&editor.awesomeEditor()}),jQuery(function(t){t(document).on("click",".cf-layout-btn",function(){var e=t(this);container=e.closest(".control-group").find(".cf-layout-classes"),isVisible=container.is(":visible"),container.slideToggle(),e.text(isVisible?e.data("show-label"):e.data("hide-label"))}),t(document).on("click",".cf-layout-classes .cf-layout > span",function(){var e=t(this).closest(".control-group").find("input");value=t.trim(e.val()),css_class=t(this).attr("class"),value=0<value.length?value+" ":value,e.val(value+css_class).trigger("change"),t(".cf-layout-btn").trigger("click")})}),jQuery(function(n){var r=n(".fm");function o(e){var t=function(e){var t=document.querySelector('.fmItem[data-key="'+e+'"]'),i=t.querySelector('input[id$="_label"]');if(i&&i.value.trim())return i.value;var n=t.querySelector('input[id$="_text"]');if(n&&n.value)return n.value;var o=t.querySelector('input[id$="_name"]');return o&&o.value?o.value:t.querySelector("h3").firstChild.nodeValue}(e).trim();document.querySelector('.fmAddedFields .item[data-key="'+e+'"] .fmFieldLabel').innerHTML=t}function i(i){running||(running=!0,isCopy=void 0!==i.copyfield,r.addClass("disabled"),n.ajax({type:"POST",url:$builder.attr("data-root")+"administrator/index.php?option=com_convertforms&view=form&layout=field&format=raw",data:i,success:function(e){isCopy?r.find(".fmItems .fmItem[data-key="+i.copyfield+"]").after(e):r.find(".fmItems").append(e),$response=n(e),fieldKey=$response.attr("data-key"),fieldLabel=$response.attr("data-label"),$field=r.find(".fmAddedFields .item:last-child").clone().attr("data-key",fieldKey).find(".fmFieldLabel").html(fieldLabel).end(),isCopy?$field.insertAfter(".fmAddedFields .item[data-key="+i.copyfield+"]"):$field.appendTo(".fmAddedFields"),r.trigger("afterAddField",[r.attr("data-nextid")]).trigger("update");var t=new CustomEvent("AfterFieldAdd",{detail:{field_key:fieldKey}});builder.dispatchEvent(t),o(fieldKey)},error:function(e,t,i){$builder.trigger("error",i)},complete:function(){running=!1,r.removeClass("disabled")}}))}function a(e){$builder.find("#sectionsTabs li a[href=#fields]").trigger("click"),d("fmItems"),r.find(".fmItem").hide().filter("[data-key="+e+"]").show(),r.trigger("afterShowField",[e])}function d(e){$tab.find('li a[href="#'+e+'"]').tab("show")}function s(e){return e=void 0===e?r.attr("data-nextid"):e,r.attr("data-formcontrol").replace("X",e)}$builder=n(".nrEditor"),builder=$builder.get(0),$tab=n("#fieldsManagerTabs"),running=!1,function(){if(el=n(".fmAddedFields"),0==el.length)return;el.sortable({update:function(e,t){!function(){var e=r.find(".fmItems");e.find(".fmItem").sort(function(e,t){return n(".fmAddedFields .item[data-key="+n(e).attr("data-key")+"]").index()-n(".fmAddedFields .item[data-key="+n(t).attr("data-key")+"]").index()}).appendTo(e)}(),r.trigger("update"),ConvertFormsBuilder.initEditorFields()}})}(),document.querySelectorAll(".fmItems .fmItem").forEach(function(e){o(e.dataset.key)}),r.find(".addField").on("click",function(e){if(void 0===n(this).attr("data-pro-only")){var t=n(this).attr("data-type");i({field:{type:t,key:r.attr("data-nextid"),name:t+"_"+r.attr("data-nextid"),label:n.trim(n(this).text())},formcontrol:encodeURIComponent(s())})}}),n(document).on("click",".fmAddedFields .item",function(){a(n(this).attr("data-key")),d("fmItems")}),n(document).on("click",".removeField",function(){var e=n(this);if(confirm("Are you sure")){var t=e.closest("div").attr("data-key");!function(e){r.find(".fmAddedFields > .item[data-key="+e+"]").remove(),r.find(".fmItem[data-key="+e+"]").remove(),r.trigger("update")}(t),e.data("focusnext")&&((t=r.find(".fmItems > .fmItem:first-child").attr("data-key"))?a(t):d("fmaddField"))}return!1}),n(document).on("click",".copyField",function(){return function(e){var t=r.find(".fmItems > .fmItem[data-key="+e+"]");field_type=t.find("input[id$=_type]").val(),field_data=t.find("input, select, textarea"),formControl=s(e);var o={};n.map(field_data.serializeArray(),function(e,t){var i=e.name.replace(formControl,"field"),n=e.value;"field[name]"==i&&(n+="_copy"),"field[key]"==i&&(n=r.attr("data-nextid")),o[i]=n}),o.formcontrol=encodeURIComponent(s()),o.copyfield=e,i(o)}(n(this).closest("div").attr("data-key")),!1}),r.on("update",function(){$builder.trigger("renderForm")}),r.on("afterAddField",function(){key=parseInt(r.attr("data-nextid"));var e=n(".fmItem[data-key="+key+"]");a(key),r.find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),n(document).trigger("subform-row-add"),function(e){e=e||document,n(e).find(".minicolors").each(function(){var e=n(this),t="color"===e.data("validate")?"hex":e.data("format")||"hex";e.minicolors({control:e.data("control")||"hue",format:"rgba"===t?"rgb":t,keywords:e.data("keywords")||"",opacity:"rgba"===t,position:e.data("position")||"default",theme:e.data("theme")||"bootstrap"})})}(e),key+=1,r.attr("data-nextid",key)}),r.on("afterShowField",function(e,t){$builder.find(".cf-control-group").removeClass("active").filter("[data-key="+t+"]").addClass("active")}),$builder.on("controlGroupClick",function(e,t){a(t)}),document.addEventListener("change",function(e){var t=e.target.closest(".fmItem");t&&o(t.dataset.key)})}),jQuery(function(d){var e=d(".st");d(".fm").on("update",function(){e.trigger("update")}),d(document).on("subform-row-add",function(){e.trigger("update")}),d(document).on("smartTagsBoxBeforeRender",function(e,t,i){var n=i.closest(".fmItem").length;if(skipFields=-1<["jform_text","jform_footer"].indexOf(i.prev().attr("id")),skip=n||skipFields,!skip){var r={},o={Submission:{"{submission.id}":"Submission ID","{submission.date}":"Submission Date","{submission.campaign_id}":"Submission Campaign ID","{submission.form_id}":"Submission Form ID","{submission.visitor_id}":"Submission Visitor ID","{submissions.count}":"Submissions Count"}},a=d(".fmItems .fmItem");a.length&&(a.each(function(){var e=d(this),t=e.find("input[id$=__name]").val();if(!t)return!0;var i=e.find("input[id$=__label]").val(),n=e.find("input[id$=__type]").val(),o=e.data("key");(i=i||d(".fmAddedFields .item[data-key="+o+"]").find(".fmFieldLabel strong").text())||(field_type_name=n.charAt(0).toUpperCase()+n.slice(1),i=field_type_name+" #"+o),name="{field."+t+"}",r[name]=i,"dropdown"!=n&&"radio"!=n||(r["{field."+t+".label}"]=i+" Label")}),r["{all_fields}"]="All Fields",r["{all_fields_filled}"]="All Filled-only Fields",o.Fields=r,d.extend(!0,t,o))}})}),jQuery(function(e){var t=e(".nrEditor");function i(){if(state=function(){if($tabs=t.find(".nav-tabs"),0!=$tabs.children().length)return tab=$tabs.find("li.active a").attr("href").replace("#",""),panel=t.find(".tab-pane#"+tab+" .accordion-body.in.collapse"),panel.length?(panel=panel.parent().attr("class").split(" "),panel=panel[1]):panel="",tab+"-"+panel}(),null!=state){formID=t.find("form").attr("pk");try{Cookies.set("ConvertFormsState"+formID,state)}catch(e){console.log(e)}}}t.find(".accordion").on("shown.bs.collapse hidden.bs.collapse",function(){i()}),t.find(".nav-tabs").on("shown.bs.tab",function(){i()})});
